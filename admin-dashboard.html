<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Writer - Admin Dashboard</title>
    <style>
        /* Your existing CSS styles */
    </style>
</head>
<body>
    <div id="app">
        <!-- Auto-login overlay -->
        <div id="autoLoginOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; display: flex; justify-content: center; align-items: center; flex-direction: column;">
            <h2>ðŸ”„ Auto-Connecting...</h2>
            <p>Attempting automatic authentication...</p>
            <div id="autoLoginStatus" style="margin-top: 20px;"></div>
        </div>

        <!-- Your existing login screen -->
        <div id="loginScreen" class="login-container">
            <!-- Your existing login form -->
        </div>

        <!-- Your existing dashboard -->
        <div id="dashboard" style="display: none;">
            <!-- Your existing dashboard content -->
        </div>
    </div>

    <script>
        // Configuration - Update these values
        const API_BASE_URL = 'https://your-resume-api.onrender.com'; // Change to your actual Render URL
        const ADMIN_SECRETS = [
            "your-secret-key-1",
            "your-secret-key-2", 
            // Add multiple possible keys if needed
        ];

        let adminKey = '';
        let currentApiUrl = API_BASE_URL;

        document.addEventListener('DOMContentLoaded', function() {
            // Show auto-login immediately
            document.getElementById('autoLoginOverlay').style.display = 'flex';
            
            // Try auto-login with multiple methods
            attemptAutoLogin();
        });

        async function attemptAutoLogin() {
            updateAutoLoginStatus('Trying environment-based authentication...');
            
            // Method 1: Try keys from the secrets array
            for (const secret of ADMIN_SECRETS) {
                if (await testAdminKey(secret)) {
                    adminKey = secret;
                    localStorage.setItem('adminKey', secret);
                    handleSuccessfulLogin();
                    return;
                }
            }
            
            // Method 2: Try localStorage saved key
            updateAutoLoginStatus('Trying saved credentials...');
            const savedKey = localStorage.getItem('adminKey');
            if (savedKey && await testAdminKey(savedKey)) {
                adminKey = savedKey;
                handleSuccessfulLogin();
                return;
            }
            
            // Method 3: Fallback to manual login
            updateAutoLoginStatus('Auto-login failed. Switching to manual login...');
            setTimeout(() => {
                showManualLogin();
            }, 2000);
        }

        async function testAdminKey(key) {
            try {
                const response = await fetch(`${currentApiUrl}/admin/stats`, {
                    headers: { 'X-Admin-Key': key }
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        function updateAutoLoginStatus(message) {
            document.getElementById('autoLoginStatus').textContent = message;
        }

        function showManualLogin() {
            document.getElementById('autoLoginOverlay').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            
            // Pre-fill with any saved key
            const savedKey = localStorage.getItem('adminKey');
            if (savedKey) {
                document.getElementById('adminKey').value = savedKey;
            }
            document.getElementById('adminKey').focus();
        }

        function handleSuccessfulLogin() {
            document.getElementById('autoLoginOverlay').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Initialize dashboard
            sessionStartTime = new Date();
            document.getElementById('sessionStart').textContent = sessionStartTime.toLocaleString();
            document.getElementById('apiBaseUrl').textContent = currentApiUrl;
            
            showMessage('Auto-authentication successful!', 'success');
            refreshStats();
            startAutoRefresh();
            startSessionTimer();
        }

        // Your existing login function (modified)
        function login() {
            const manualKey = document.getElementById('adminKey').value.trim();
            if (!manualKey) {
                showLoginMessage('Please enter your Admin Secret Key', 'error');
                return;
            }

            document.getElementById('loginScreen').classList.add('loading');
            
            fetch(`${currentApiUrl}/admin/stats`, {
                headers: { 'X-Admin-Key': manualKey }
            })
            .then(response => {
                if (response.ok) {
                    adminKey = manualKey;
                    localStorage.setItem('adminKey', manualKey);
                    handleSuccessfulLogin();
                } else {
                    throw new Error('Invalid key');
                }
            })
            .catch(error => {
                document.getElementById('loginScreen').classList.remove('loading');
                showLoginMessage('Login failed: ' + error.message, 'error');
            });
        }

        // Keep all your existing functions (showMessage, refreshStats, etc.) unchanged
        function showLoginMessage(message, type) {
            // Your existing implementation
        }

        function showMessage(message, type) {
            // Your existing implementation  
        }

        function refreshStats() {
            // Your existing implementation
        }

        // ... rest of your existing JavaScript functions
    </script>
</body>
</html>
